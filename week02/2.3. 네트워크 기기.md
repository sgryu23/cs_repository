# 2.3 네트워크의 기초
## 2.3.1 네트워크 기기

네트워크는 여러 개의 네트워크 기기를 기반으로 구축된다
네트워크 기기는 계층별로 처리 범위를 나눌 수 있다
- 애플리케이션 계층 : L7 스위치
- 인터넷 계층 : 라우터, L3 스위치
- 데이터 링크 계층 : 브리지, L2 스위치
- 물리 계층 : NIC, 리피터, AP
> 상위 계층을 처리하는 기기는 하위 계층을 처리할 수 있지만 그 반대는 불가

## 2.3.2 애플리케이션 계층을 처리하는 기기

### L7 스위치
> 스위치는 기본적으로 여러 장비를 연결하고 데이터 통신을 중재한다 목적지가 연견될 포트로만 전기 신호를 보내 통신을 한다

- L7 스위치는 **로드밸런서** 라고도 한다
- 서버의 부하를 분산하는 기기이다
- 클라이언트로부터 오는 요청들을 뒤쪽의 여러 서버로 나누는 역할을 한다 
  - 클라이언트 -> (---) -> 로드밸런서 -> 여러대의 서버 
- 시스템이 처리할 수 있는 **트래픽 증가**를 목표로 한다
- URL,서버,캐시,쿠키들을 기반으로 트래픽을 분산한다
- 바이러스,불필요한 외부 데이터 등을 걸러내는 필터링 기능을 가진다
- 로드밸런서는 L7과 L4 또한 가지는데,
  - **L4 스위치는 인터넷 계층**을 처리하는 기기이다 
  - L4 스위치는 IP와 포트를 기반으로 트래픽을 분산한다
  - L7 로드밸런서는 IP,포트 외에도 URL,HTTP 헤더,쿠키 등을 기반으로 트래픽을 분산한다 
  - 두 스위치 모두 헬스 체크를 통해 정상,비정상적인 서버를 판별한다
  - > 헬스 체크 : 전송 주기와 재전송 횟수 등을 설정한 이후 반복적으로 서버에 요청을 보내는 것
- 로드밸런서의 대표적인 기능에는 **서버 이중화**가 있다
  - 로드밸런서는 2대 이상의 서버를 기반으로 가상 IP를 제공하고 이를 기반으로 안정적인 서비스를 제공한다

## 2.3.3 인터넷 계층을 처리하는 기기

### 라우터
- 여러개의 네트워크를 연결,분할,구분 시켜주는 역할
- 소프트웨어 기반, 하드웨어 기반의 라우팅하는것으로 나뉘어 진다
- 다른 네트워크에 존재하는 장치끼리 서로 데이터를 주고받을 때 패킷 소모를 최소화한다
- 경로를 최적화하여 최소 경로로 패킷을 포워딩한다
- 공유기가 여기에 속한다

### L3 스위치
- L2 스위치의 기능과 라우팅 기능을 갖춘 장비
- L3 == 라우터
- L3는 하드웨어 기반의 라우팅을 담당하는 스위치

| 구분        | L2 스위치       | L3 스위치     |
| ----------- | --------------- | ------------- |
| 참조 테이블 | MAC 주소 테이블 | 라우팅 테이블 |
| 참조 PDU    | 이더넷 프레임   | IP 패킷       |
| 참조 주소   | MAC 주소        | IP 주소       |

## 2.3.4 데이터 링크 계층을 처리하는 기기

### L2 스위치
- 장치들의 •MAC 주소를 기반으로 장치를 관리한다
- 연결된 장치로부터 패킷이 왔을 때 패킷 전송을 담당한다
- 이를 위해 MAC 주소 테이블을 사용함 (IP주소 이해 불가)
- 목적지가 MAC 주소 테이블에 없다면 전체 포트 전달
- 주소는 일정 시간 이후 삭제하는 기능도 있다
> MAC (Media Access Control Address) 
> - MAC 주소는 간단히 말해 인터넷을 할 수 있는 이더넷 기반 기기에는 모두 다 하나씩 할당되어 있는 고유한 ID이다

### 브릿지
- 두 개의 근거리 통신망(LAN)을 상호 접속할 수 있도록 하는 통신망 연결 장치
- 포트와 포트 사이의 다리 역할을 한다
- 장치에서 받아온 MAC 주소-> MAC 주소 테이블로 관리
- **즉 통신망 범위를 확장하고 서로 다른 LAN 등으로 이루어진 '하나의' 통신망을 구축할 때 쓰인다**

## 2.3.5 물리 계층을 처리하는 기기

### NIC
- LAN 카드라고 하는 네트워크 인터페이스 카드(NIC, Network Interface Card)
- 2대 이상의 컴퓨터 네트워크를 구성하는데 사용한다
- 빠른 속도로 데이터를 송수신할 수 있게 컴퓨터에 설치하는 확장 카드
- 각 LAN 카드에는 주민등록번호처럼 각각을 구분하기 위한 고유의 식별번호인 MAC 주소가 있다

### 리피터
- 들어오는 약해진 신호 정도를 증폭하여 다른 쪽으로 전달하는 장치
- 이를 통해 패킷이 더 멀리 갈 수 있다
- 하지만 요즘에는 잘 쓰이지 않는다 (광케이블 보급)

### AP (Access Point)
- AP에 유선 LAN을 연결한 후 다른 장치에서 무선 LAN 기술(와이파이)을 사용하여 무선 네트워크 연결 가능

# 2.4 IP
## 2.4.1 ARP (Address Resolution Protocol)
>IP 주소를 통한 인터넷 계층의 통신이란, IP 주소를 기반으로 MAC 주소를 찾아 통신을 진행하는 과정
- ARP는 가상 주소인 IP 주소를 실제 주소 MAC주소로 변환할 때 다리 역할을 하는 프로토콜
  - IP(가상 주소) -> (ARP) -> MAC(실제 주소)
- RARP는 반대로 실제 주소인 MAC 주소를 가상 주소인 IP 주소로 변환
  - MAC(실제 주소) -> (ARP) -> IP(가상 주소)
- 가상 주소 (IP)를 실제 주소 (MAC)으로 변환하는 과정이 필요하다.

## 2.4.2 홉 바이 홉 통신
- 홉(Hop)이란 영어 뜻 자체로는 건너뛰는 모습을 의미한다
- 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 비유적으로 표현
- 라우팅을 통해 라우팅 테이블을 만들고, 실제로 패킷이 라우팅 테이블을 타고 최종 목적지까지 도달하는 통신을 말한다
  - **라우팅 테이블** :
  - 송신지에서 수신지까지 도달하기 위해 사용된다
  - 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기 위한 방법이 들어있는 리스트
  - 게이트웨이와 모든 목적이데 대해 해당 목적지에 도달하기 위해 거쳐야 할 다음 라우터의 정보를 갖고 있다
  - **게이트 웨이** : 
  - 서로 다른 네트워크, 프로토콜 간 통신을 중간에서 가능하도록 하는 매개체(컴퓨타,소프트웨어..등등)

## 2.4.3 IP 주소 체계

- IPv4 : 
  - 32비트를 8비트 단위로 점을 찍어 표기 (ex- 255.255.255.0)
- IPv6 :
  - 128비트를 16비트 단위로 점을 찍어 표기 (ex- 2001:db8::ff00:42:8329)
  - IPv4의 한계를 극복하기 위해 나타난 방식이지만, IPv4에 비해 보급이 더디다

### 클래스 기반 할당 방식
- IP주소 체계는 처음에 A,B,C,D,E 다섯개의 클래스로 구분하는 클래스 기반 할당 방식(Classful Addressing)을 사용하였다
- 클래스 A,B,C는 일대일 통신, 클래스 D는 멀티캐스트 통신, 클래스 E는 예비용으로 선점된다
- 클래스 A: 0.0.0.0 ~ 127.255.255.255
- 클래스 B: 128.0.0.0 ~ 191.255.255.255
- 클래스 C: 192.0.0.0 ~ 223.255.255.255
- 맨 왼쪽에 있는 비트를 '구분 비트'라고 한다
- 하지만 이 방식은 사용하는 주소보다 버리는 주소가 많은 단점이 있다
  - 해소하기 위해 DHCP와 IPv6, NAT등장

### DHCP (Dynamic Host Configuration Protocol)
- IP 주소 및 기타 통신 매개변수를 자동으로 할당하기 위한 네트워크 관리 프로토콜
- 네트워크 장치의 IP 주소를 수동으로 설정할 필요 없이 인터넷에 접속할 때 마다 자동으로 IP주소 할당 가능
- 많은 라우터,게이트웨이 장비에 이 기능이 있고, 이를 통해 대부분의 가정용 네트워크에서 IP 주소를 할당한다

### NAT (Network Address Translation)
- IPv4 주소 체계만으로는 많은 주소들을 감당하지 못해, 이를 해결하기 위해 공인 IP, 사설 IP로 나눈다
- 패킷이 라우팅 장치를 통해 전송되는 동안 IP 주소 정보를 수정하여 다른 주소로 매핑하는 방법
- 기업체 등에서 여러 개의 호스트는 사설 IP를 통해 내부적으로 구분되고, 하나의 공인 IP 주소를 사용(로 변환)하여, 여러 명이 동시에 인터넷에 접속할 수 있다
- 장점 :
  - 내부 네트워크에서 사용하는 IP 주소와 외부에 드러나는 주소를 다르게 유지할 수 있기 때문에 내부 네트워크에 대한 어느 정도의 **보안** 기능을 한다
- 단점 :
  - 여러 명이 동시에 인터넷을 접속하게 되므로, 실제로 접속하는 호스트 숫자에 따라서 **접속 속도**가 느려질 수 있다

## 2.4.4 IP 주소를 이용한 위치 정보
- IP 주소는 **인터넷에서 사용하는 네트워크 주소**이기 때문에 이를 통해 동 또는 구까지 위치 추적이 가능하다

# 2.5 HTTP
### 2.5.1 HTTP/1.0
- 한 연결당 하나의 요청을 처리한다 -> RTT(패킷 왕복 시간) 증가
- 그래서 요청 하나당 3 Way-Handshake등의 과정을 거쳐야 한다 -> RTT(패킷 왕복 시간) 증가
- 이를 해결하기 위해 이미지 스플리팅, 코드 압축, 이미지 Base64 인코딩을 사용하곤 하였다

### 2.5.2 HTTP/1.1
- HTTP/1.0에서 발전한 것
- 매번 TCP 연결을 하는 것이 아니라, 한번 TCP를 초기화 한 후 Keep-alive 옵션으로 여러개의 파일을 송수신 하게 바뀌었다
- HTTP/1.0에서도 keep-alive가 있었지만 표준화가 되어 있지 않았고 HTTP/1.1부터 표준화가 되어 기본 옵션으로 설정되었다
> **HOL Blocking**
> - HTTP/1.x 버전에서 발생하는 문제로 같은 큐에 있는 패킷이 그 첫 번째 패킷에 의해 지연될 때 발생하는 성능 저하 현상을 말한다

### 2.5.3 HTTP/2
- SPDY 프로토콜에서 파생된 HTTP/1.x 보다 지연 시간을 줄이고 응답을 더 빠르게 할수 있다
- _멀티플렉싱, 헤더 압축, 서버 푸시_, 요청의 우선순위 처리를 지원한다
- 멀티 플렉싱 : 
  - 여러 개의 스트림을 사용하여 송수신한다
  - 특정 스트림의 패킷이 손실되었다고 해도 해당 스트림에만 영향을 미친다 (나머지는 멀쩡)
- 헤더 압축 : 
  - HTTP/1.x 에는 크기가 큰 헤더라는 문제가 있었다
  - huffman coding 알고리즘을 이용하여, 문자열을 문자 단위로 쪼개, 전체 데이터의 표현에 필요한 비트양을 줄이게 되었다
- 서버 푸시 : 
  - 기존에는 클라이언트가 서버에 요청을 해야 파일을 다운로드 받을 수 있었지만, HTTP/2에서는 서버가 클라이언트로부터의 요청 없이 리소스를 바로 푸시할 수 있다

### 2.5.4 HTTPS
- HTTPS는 애플리케이션 계층과 전송 계층 사이에 신뢰 계층인 SSL/TLS 계층을 넣어 신뢰할 수 있는 HTTP 요청을 말한다
- HTTP/2는 HTTPS 위에서 동작
#### SSL/TLS
- 전송 계층에서 보안을 제공하는 프로토콜
- 클라이언트와 서버가 통신할 때 SSL/TLS를 통해 제3자가 메시지를 도청하거나 변조하지 못하도록 한다 -> 인터셉터 방지
- *보안 세션*을 기반으로 데이터를 암호화하며, 보안 세션이 만들어질 때 인증 메커니즘, 키 교환 암호화 알고리즘, 해싱 알고리즘이 사용된다
> 보안 세션
> - 보안이 시작되고 끝나는 동안 유지되는 세션
> - SSL/TLS는 HandShake를 통해 보안 세션을 생성하고, 이를 통해 상태 정보 등을 공유

### 2.5.5 HTTP/3
- TCP가 아닌 UDP 기반
- TCP 위에서 돌아가는 HTTP/2와는 달리 HTTP/3은 QUIC이라는 계층 위에서 돌아간다
  - QUIC는 TCP를 사용하지 않기에 통신을 시작할 때 3 Way-Handshake같은 과정을 거치지 않는다 -> **지연 시간을 감소**하는 장점이 있다 